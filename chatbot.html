<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI MEDIC</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

  <style>
    :root{
      --brand-red:#e60000;
      --brand-red-dark:#c40000;
      --ink:#111;
      --ink-2:#333;
      --paper:#fcf7f7;
    }
    html { scroll-behavior:smooth; }
    body{
      background-color: var(--paper);
      color: var(--ink);
      font-family: 'Segoe UI', system-ui, -apple-system, Arial, sans-serif;
      overflow-x:hidden;
      line-height:1.55;
    }
    .navbar{
      background:#fff !important;
      box-shadow:0 6px 24px rgba(0,0,0,.06);
    }
    .navbar-brand,
    .nav-link{ color:var(--ink-2) !important; }
    .navbar-brand .text-danger,
    .navbar-brand,
    .nav-link:hover{ color:var(--brand-red) !important; }
  .header .container{ max-width:1100px; }
    .hero-section{ padding:60px 15px; }
    .hero-image img{
      width:100%;
      border-radius:20px;
      display:block;
    }
    .btn-emergency{
      background-color:var(--brand-red);
      color:#fff;
      border:none;
      transition: transform .2s ease, box-shadow .2s ease, background-color .2s ease;
    }
    .btn-emergency:hover{
      background-color:var(--brand-red-dark);
      transform: translateY(-1px);
      box-shadow:0 8px 18px rgba(0,0,0,.08);
    }
    .btn-ask-ai{
      background-color:#f0f0f0;
      color:#333;
      border:none;
      transition: transform .2s ease, box-shadow .2s ease, background-color .2s ease;
    }
    .btn-ask-ai:hover{
      background-color:#eaeaea;
      transform: translateY(-1px);
      box-shadow:0 8px 18px rgba(0,0,0,.08);
    }
    .splash{
      position:fixed; inset:0;
      height:100vh; width:100vw;
      background-color:#ffffff;
      display:flex; justify-content:center; align-items:center;
      z-index:9999;
    }
    .app-logo{
      width:90px; height:90px; opacity:0;
      animation:fadeZoom 1.2s ease-in-out forwards;
    }
    @keyframes fadeZoom{
      0%{ transform:scale(.6); opacity:0; }
      100%{ transform:scale(1); opacity:1; }
    }
    .brand-title{ font-size:24px; font-weight:700; margin-top:15px; color:#d70000; }
    .tagline{ font-size:14px; color:#444; margin-top:5px; }
    .dots span{
      display:inline-block; width:6px; height:6px; margin:8px 2px;
      background-color:#d70000; border-radius:50%;
      animation:blink 1.2s infinite ease-in-out both;
    }
    .dots span:nth-child(2){ animation-delay:.2s; }
    .dots span:nth-child(3){ animation-delay:.4s; }
    @keyframes blink{
      0%,80%,100%{ opacity:0; }
      40%{ opacity:1; }
    }

    footer{
      background-color: #fff;
      color: var(--ink);
      padding:50px 0 20px;
      margin-top:50px;
      box-shadow:0 -4px 16px rgba(0,0,0,.05);
    }
    footer h5, footer h6{
      font-size:1.15rem;     
      font-weight:600;       
      margin-bottom:20px;
      text-transform:uppercase;
      color:var(--brand-red);
      letter-spacing:.3px;
    }
    .footertext{ color:var(--brand-red) !important; }

    footer a.footer-link{
      color:var(--ink-2);
      text-decoration:none;
      display:block;
      margin-bottom:8px;
      position:relative;
      transition:color .25s ease;
    }
    /* subtle underline grow on hover */
    footer a.footer-link::after{
      content:'';
      position:absolute;
      left:0; bottom:-2px;
      width:0; height:2px;
      background:var(--brand-red);
      transition:width .25s ease;
    }
    footer a.footer-link:hover{
      color:var(--brand-red);
    }
    footer a.footer-link:hover::after{ width:100%; }

    /* Social icons row + hover */
    .social-icon{
      display:inline-block;
      margin-left:10px;
      font-size:1.1rem;
      color:var(--ink-2);
      transition: transform .2s ease, color .25s ease, text-shadow .2s ease;
    }
    .social-icon:first-child{ margin-left:0; }
    .social-icon:hover{
      color:var(--brand-red);
      transform: translateY(-1px) scale(1.06);
      text-shadow:0 0 10px rgba(230,0,0,.15);
    }
    /* Fine-tuned alignment & spacing */
    @media (max-width: 991.98px){
      .hero-section .row > [class*="col-"]{ text-align:center; }
      .hero-section .btn{ margin-bottom:10px; }
      .social-icon{ margin:0 8px; }
    }
    /* ye chatbot ki styling hai */
       body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      /* height: 100vh;
      display: flex;
      overflow: hidden; */
    }

    .main-container {
      display: flex;
      flex: 1;
      overflow: hidden;
      position: relative;
      width: 100%;
    }
       #toggleSidebar {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1100;
    }

    .sidebar {
      width: 260px;
      background: #ffffff;
      border-right: 1px solid #eee;
      display: flex;
      flex-direction: column;
      padding: 1rem;
      overflow-y: auto;
      flex-shrink: 0;
      max-height: 100vh;
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    @media (max-width: 768px) {
      .sidebar {
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        transform: translateX(-100%);
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      }

      .sidebar.open {
        transform: translateX(0);
      }
    }

    .chat-title {
      font-size: 18px;
      margin-bottom: 1rem;
      font-weight: 600;
    }

    .chat-list-container {
      flex-grow: 1;
      overflow-y: auto;
    }

    .chat-item {
      padding: 10px;
      background: #f5f5f5;
      border-radius: 6px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .chat-item:hover {
      background: #e6e6e6;
    }

    .sidebar-buttons {
      margin-top: auto;
      padding-top: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .chat-container {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      padding: 1rem;
      overflow: hidden;
      min-width: 0;
    }

    .messages {
      flex-grow: 1;
      overflow-y: auto;
      padding: 1rem;
      background: #fff;
      border-radius: 8px;
      margin-bottom: 1rem;
      display: flex;
      flex-direction: column;
    }

    .message {
      margin-bottom: 10px;
      padding: 10px 14px;
      border-radius: 12px;
      max-width: 75%;
    }

    .user-msg {
      align-self: flex-end;
      background: #007bff;
      color: #fff;
    }

    .bot-msg {
      align-self: flex-start;
      background: #f0f0f0;
    }

    .input-area {
      display: flex;
      gap: 0.5rem;
    }

    .form-control {
      flex: 1;
      border-radius: 12px;
    }

    .btn-send,
    .btn-mic {
      border-radius: 12px;
    }

    .sidebar::-webkit-scrollbar,
    .messages::-webkit-scrollbar {
      width: 8px;
    }

    .sidebar::-webkit-scrollbar-thumb,
    .messages::-webkit-scrollbar-thumb {
      background: #ccc;
      border-radius: 8px;
    }

    .disabled-input {
      background-color: #e9ecef;
      opacity: 0.6;
      cursor: not-allowed;
    }

    .disabled-button {
      opacity: 0.6;
      cursor: not-allowed;
      pointer-events: none;
    }
    .response-buttons {
  display: none;
  margin-top: 6px;
  gap: 6px;
}

.bot-msg:hover .response-buttons {
  display: flex;
}
  </style>
</head>
<body>
  <!-- Splash Screen -->
  <div class="splash" id="splash">
    <div class="logo-wrap text-center">
      <img src="Files/logo.png" alt="AI Medic Logo" class="app-logo"/>
      <div class="brand-title">AI MEDIC</div>
      <div class="tagline">Stay calm, act fast ‚Äì your AI medic is here.</div>
      <div class="dots"><span></span><span></span><span></span></div>
    </div>
  </div>

  <!-- Header -->
  <div class="header">
    <div class="container py-2">
      <div class="row text-center align-items-center gy-2">
        <div class="col-12">
          <p id="livetime" class="fs-2 mb-0">00:00:00</p>
        </div>
      </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm px-4">
      <a class="navbar-brand fw-bold d-flex align-items-center" href="index.html">
        <img src="Files/logo.png" width="32" alt="AI Medic Logo" class="me-2">
        <span class="text-danger">AI MEDIC</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="instructions.html">Instruction</a></li>
          <li class="nav-item"><a class="nav-link" href="about.html">About Us</a></li>
          <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
        </ul>
      </div>
    </nav>
  </div>

  <!-- Hero -->
<!-- ye chatbot ka main hai -->
  <div class="main-container">
    
    <button class="btn btn-outline-secondary d-md-none" id="toggleSidebar">‚ò∞</button>

    <div class="sidebar" id="sidebar">
      <!-- <h5 class="chat-title">AiMedic</h5> -->
      <div class="chat-list-container" id="chatList"></div>
      <div class="sidebar-buttons">
        <button class="btn btn-sm btn-primary w-100" id="newChat">+ New Chat</button>
        <button class="btn btn-sm btn-danger w-100" id="clearChat">üóëÔ∏è Clear Chat</button>
      </div>
    </div>

    <div class="chat-container">
      <div class="messages" id="messages"></div>
      <div class="input-area">
        <form id="messageForm" style="display: flex; width: 100%; gap: 0.5rem;">
          <input type="text" id="userInput" class="form-control" placeholder="Type a message..." disabled>
          <button type="button" class="btn btn-primary btn-send disabled-button" id="sendBtn" disabled>üì§</button>
          <button type="button" class="btn btn-secondary btn-mic disabled-button" id="micBtn" disabled>üéôÔ∏è</button>
        </form>
      </div>
    </div>
  </div>
  <!-- Footer -->
  <footer class="text-dark pt-5 pb-4">
    <div class="container text-center text-md-start">
      <div class="row text-md-left">
        <!-- LOGO & DESCRIPTION -->
        <div class="col-md-5 col-lg-5 col-xl-5 mx-auto mt-3 px-5">
          <h5 class="text-uppercase fw-bold mb-3 footertext">AI MEDIC</h5>
          <p>
            <a class="footer-link d-inline" href="index.html">AI Medic</a> is a smart medical assistant designed to provide instant, reliable, and easy-to-follow health guidance. Our mission is to make emergency help and first-aid knowledge accessible to everyone, anytime and anywhere.
          </p>
        </div>
        <!-- WEBSITE LINKS -->
        <div class="col-md-3 col-lg-3 col-xl-3 mx-auto mt-3">
          <h6 class="text-uppercase fw-bold mb-3 footertext">Quick Links</h6>
          <ul class="list-unstyled">
            <li class="mb-3"><a href="index.html" class="footer-link">HOME</a></li>
            <li class="mb-3"><a href="instructions.html" class="footer-link">INSTRUCTION</a></li>
            <li class="mb-3"><a href="about.html" class="footer-link">ABOUT US</a></li>
            <li class="mb-3"><a href="contact.html" class="footer-link">CONTACT</a></li>
          </ul>
        </div>
        <!-- CONTACT INFO -->
        <div class="col-md-4 col-lg-4 col-xl-4 mx-auto mt-3 mb-2">
          <h6 class="text-uppercase fw-bold mb-3 footertext">Contact Us</h6>
          <p class="text-dark-50"><i class="fas fa-map-marker-alt me-2 mb-2"></i> Karachi, Pakistan</p>
          <p class="text-dark-50"><i class="fas fa-envelope me-2 mb-2"></i> aimedic807@gmail.com</p>
          <p class="text-dark-50"><i class="fas fa-phone me-2 mb-2"></i> +92 300 1234567</p>
        </div>

        <a href="Code Crafters.html"
           class="text-uppercase fw-bold text-center d-block mt-3 mb-3 fs-5 footertext text-decoration-none personaldetails">
          <span class="border-top border-bottom border-info py-2 d-inline-block">code crafters</span>
        </a>

        <hr class="my-4 text-dark-50">

        <div class="row align-items-center">
          <div class="col-md-6 col-lg-8">
            <p class="text-dark-50 mb-0">
              ¬© 2025 <span class="footertext"><a href="index.html" class="footer-link d-inline">AI Medic</a></span> all rights reserved.
            </p>
          </div>
          <div class="col-md-6 col-lg-4 text-md-end">
            <!-- Social icons: will animate one-by-one -->
            <a href="https://www.facebook.com/" target="_blank" class="social-icon" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
            <a href="https://www.whatsapp.com/" target="_blank" class="social-icon" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
            <a href="https://www.instagram.com/" target="_blank" class="social-icon" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
            <a href="https://www.linkedin.com/" target="_blank" class="social-icon" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
            <a href="https://github.com/" target="_blank" class="social-icon" aria-label="GitHub"><i class="fab fa-github"></i></a>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Splash (kept as-is functionally)
    window.addEventListener("load", () => {
      setTimeout(() => {
        document.getElementById("splash").style.display = "none";
      }, 600);
    });
    // Live Clock
    setInterval(() => {
      let now = new Date();
      document.getElementById("livetime").innerText = now.toLocaleTimeString();
    }, 1000);

    // ===== GSAP Animations (Desktop + Mobile) =====
    gsap.registerPlugin(ScrollTrigger);

    // Respect reduced motion
    const reduceMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    const ease = "power2.out";

    // Initial (on load) ‚Äì header + navbar
    if(!reduceMotion){
      gsap.from(".navbar-brand", {y:-12, opacity:0, duration:.6, delay:.1, ease});
      gsap.from(".navbar-nav .nav-link", {y:-10, opacity:0, duration:.5, stagger:.08, delay:.15, ease});
      gsap.from("#livetime", {y:-8, opacity:0, duration:.6, stagger:.15, delay:.2, ease});
    }

    // MatchMedia for desktop vs mobile subtle differences
    const mm = gsap.matchMedia();

    // Desktop (>=992px)
    mm.add("(min-width: 992px)", () => {
      if(reduceMotion) return;

      // Hero image + text
      gsap.from(".hero-image img", {
        x:-60, opacity:0, duration:1, ease,
        scrollTrigger:{ trigger:".hero-image", start:"top 80%" }
      });
      gsap.from(".hero-section h2", {
        y:30, opacity:0, duration:.9, delay:.1, ease,
        scrollTrigger:{ trigger:".hero-section h2", start:"top 82%" }
      });
      gsap.from(".hero-section p", {
        y:24, opacity:0, duration:.9, delay:.2, ease,
        scrollTrigger:{ trigger:".hero-section p", start:"top 85%" }
      });
      gsap.from(".hero-section .btn", {
        scale:.94, opacity:0, duration:.7, stagger:.15, delay:.25, ease,
        scrollTrigger:{ trigger:".hero-section .btn", start:"top 88%" }
      });

      // Footer headings + text
      gsap.from("footer h5, footer h6", {
        y:28, opacity:0, duration:.9, stagger:.15, ease,
        scrollTrigger:{ trigger:"footer", start:"top 92%" }
      });
      gsap.from("footer .footer-link, footer p", {
        y:18, opacity:0, duration:.8, stagger:.08, ease,
        scrollTrigger:{ trigger:"footer", start:"top 95%" }
      });

      // Social icons one-by-one
      gsap.from("footer .social-icon", {
        y:12, opacity:0, duration:.6, stagger:.12, ease,
        scrollTrigger:{ trigger:"footer .social-icon", start:"top 98%" }
      });
    });

    // Mobile (<992px) ‚Äì gentler
    mm.add("(max-width: 991.98px)", () => {
      if(reduceMotion) return;

      gsap.from(".hero-image img", {
        opacity:0, scale:.98, duration:.9, ease,
        scrollTrigger:{ trigger:".hero-image", start:"top 85%" }
      });
      gsap.from(".hero-section h2, .hero-section p", {
        opacity:0, y:16, duration:.8, stagger:.12, ease,
        scrollTrigger:{ trigger:".hero-section h2", start:"top 88%" }
      });
      gsap.from(".hero-section .btn", {
        opacity:0, y:12, duration:.6, stagger:.12, ease,
        scrollTrigger:{ trigger:".hero-section .btn", start:"top 92%" }
      });
      gsap.from("footer h5, footer h6, footer .footer-link, footer p", {
        opacity:0, y:14, duration:.7, stagger:.08, ease,
        scrollTrigger:{ trigger:"footer", start:"top 96%" }
      });
      gsap.from("footer .social-icon", {
        opacity:0, y:10, duration:.55, stagger:.1, ease,
        scrollTrigger:{ trigger:"footer .social-icon", start:"top 98%" }
      });
    });

    // Hover micro-interactions for social icons (extra subtle)
    document.querySelectorAll(".social-icon").forEach((el) => {
      el.addEventListener("mouseenter", () => {
        if(reduceMotion) return;
        gsap.to(el, { y:-2, duration:.2, ease:"power1.out" });
      });
      el.addEventListener("mouseleave", () => {
        if(reduceMotion) return;
        gsap.to(el, { y:0, duration:.2, ease:"power1.out" });
      });
    });

    // Scroll-to-top button show/hide via ScrollTrigger
    if(!reduceMotion){
      ScrollTrigger.create({
        start: 300,
        onEnter: ()=> showToTop(true),
        onLeaveBack: ()=> showToTop(false)
      });
    }
    function showToTop(show){
      const btn = document.getElementById("toTop");
      if(show){
        btn.style.visibility = "visible";
        gsap.to(btn, {opacity:1, y:0, duration:.25, ease:"power1.out"});
      }else{
        gsap.to(btn, {opacity:0, y:12, duration:.25, ease:"power1.in", onComplete:()=>{ btn.style.visibility = "hidden"; }});
      }
    }
// ye chatbot ki script hai
  document.addEventListener('DOMContentLoaded', function () {
    const messages = document.getElementById("messages");
    const sendBtn = document.getElementById("sendBtn");
    const userInput = document.getElementById("userInput");
    const micBtn = document.getElementById("micBtn");
    const chatList = document.getElementById("chatList");
    const clearChatBtn = document.getElementById("clearChat");
    const messageForm = document.getElementById("messageForm");
    const toggleSidebarBtn = document.getElementById("toggleSidebar");
    const sidebar = document.getElementById("sidebar");

    let recognition;
    let currentChatTitle = "";
    let isBotResponding = false;
    let currentUtterance = null;

    const API_URL = "https://openrouter.ai/api/v1/chat/completions";
    const API_KEY = "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";

    toggleSidebarBtn.addEventListener("click", function () {
      sidebar.classList.toggle("open");
    });

    function disableInput() {
      userInput.disabled = true;
      userInput.classList.add("disabled-input");
      sendBtn.disabled = true;
      sendBtn.classList.add("disabled-button");
      micBtn.disabled = true;
      micBtn.classList.add("disabled-button");
      isBotResponding = true;
    }

    function enableInput() {
      userInput.disabled = false;
      userInput.classList.remove("disabled-input");
      sendBtn.disabled = false;
      sendBtn.classList.remove("disabled-button");
      micBtn.disabled = false;
      micBtn.classList.remove("disabled-button");
      isBotResponding = false;
      userInput.focus();
    }

    function stopSpeech() {
      const synth = window.speechSynthesis;
      if (synth.speaking) synth.cancel();
      currentUtterance = null;
    }

    function appendMessage(text, sender = "user") {
      const msg = document.createElement("div");
      msg.className = `message ${sender === "user" ? "user-msg" : "bot-msg"}`;

      const messageText = document.createElement("div");
      messageText.textContent = text;
      msg.appendChild(messageText);

      if (sender === "bot") {
        const buttons = document.createElement("div");
        buttons.className = "response-buttons";

        const speakBtn = document.createElement("button");
        speakBtn.className = "btn btn-sm btn-outline-secondary";
        speakBtn.innerText = "üîä";
        speakBtn.title = "Speak";
        speakBtn.onclick = () => speakText(text);

        const copyBtn = document.createElement("button");
        copyBtn.className = "btn btn-sm btn-outline-secondary";
        copyBtn.innerText = "üìã";
        copyBtn.title = "Copy";
        copyBtn.onclick = () => navigator.clipboard.writeText(text);

        const translateBtn = document.createElement("button");
        translateBtn.className = "btn btn-sm btn-outline-secondary";
        translateBtn.innerText = "üåê";
        translateBtn.title = "Translate";
        translateBtn.onclick = () => alert("Translation feature coming soon!");

        buttons.append(speakBtn, copyBtn, translateBtn);
        msg.appendChild(buttons);
      }

      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
    }

    async function sendMessage() {
      if (isBotResponding) return;
      const text = userInput.value.trim();
      if (!text) return;

      
      const emergencyKeywords = ["emergency", "ambulance", "police", "fire", "help", "madad", "rescue"];
      const lowerText = text.toLowerCase();
      if (emergencyKeywords.some(word => lowerText.includes(word))) {
        appendMessage(
          "üìû *Pakistani Emergency Helplines:*\n" +
          "üöì Police: 15\n" +
          "üöë Ambulance: 115 / 1122\n" +
          "üî• Fire Brigade: 16\n" +
          "üö® Rescue 1122: 1122\n" +
          "üíâ Edhi Foundation: 115\n" +
          "üö∫ Women Helpline: 1098\n" +
          "üë∂ Child Protection: 1121",
          "bot"
        );
        return enableInput();
      }

      disableInput();
      appendMessage(text, "user");
      userInput.value = "";

      if (!currentChatTitle) {
        currentChatTitle = text.length > 20 ? text.substring(0, 20) + "..." : text;
        const chatItem = document.createElement("div");
        chatItem.className = "chat-item";
        chatItem.textContent = currentChatTitle;
        chatItem.onclick = () => alert("Chat loading not implemented yet");
        chatList.appendChild(chatItem);
      }

      appendMessage("Typing...", "bot");
      const botMsgEl = messages.lastChild;

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${API_KEY}`,
          },
          body: JSON.stringify({
            model: "openai/gpt-3.5-turbo",
            messages: [{ role: "user", content: text }],
          }),
        });
        const data = await res.json();
        const reply = data.choices?.[0]?.message?.content || "Sorry, no response.";
        botMsgEl.querySelector('div').textContent = reply;

        enableInput(); 
      } catch (err) {
        console.error("API Error:", err);
        botMsgEl.textContent = "‚ö†Ô∏è Failed to fetch response.";
        enableInput();
      }
    }

    function speakTextAndEnableInput(text) {
      stopSpeech();
      currentUtterance = new SpeechSynthesisUtterance(text);
      currentUtterance.lang = /[ÿ°-Ÿä]/.test(text) ? "ur-PK" : "en-US";
      currentUtterance.onend = enableInput;
      currentUtterance.onerror = enableInput;
      window.speechSynthesis.speak(currentUtterance);
    }

    function speakText(text) {
      stopSpeech();
      currentUtterance = new SpeechSynthesisUtterance(text);
      currentUtterance.lang = /[ÿ°-Ÿä]/.test(text) ? "ur-PK" : "en-US";
      window.speechSynthesis.speak(currentUtterance);
    }

    messageForm.addEventListener('submit', e => {
      e.preventDefault();
      sendMessage();
    });

    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        e.preventDefault();
        sendMessage();
      }
    });

    micBtn.addEventListener('click', () => {
      if (!('webkitSpeechRecognition' in window)) {
        alert("Speech Recognition not supported");
        return;
      }
      if (!recognition) {
        recognition = new webkitSpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = "ur-PK";
        recognition.onresult = event => {
          userInput.value = event.results[0][0].transcript;
          sendMessage();
        };
        recognition.onerror = e => console.error("Speech error", e);
      }
      recognition.start();
    });

    document.getElementById("newChat").addEventListener('click', () => {
      stopSpeech();
      currentChatTitle = "";
      messages.innerHTML = "";
      setTimeout(() => {
        disableInput();
        appendMessage("Hello! I'm your medical assistant. How can I help you today?", "bot");
        setTimeout(enableInput, 3000);
      }, 100);
    });

    clearChatBtn.addEventListener('click', () => {
      stopSpeech();
      messages.innerHTML = "";
      currentChatTitle = "";
      setTimeout(() => {
        disableInput();
        appendMessage("Hello! I'm your AI-MEDIC assistant. How can I help you today?", "bot");
        setTimeout(enableInput, 3000);
      }, 100);
    });

    setTimeout(() => {
      disableInput();
      appendMessage("Hello! I'm your AI-MEDIC assistant. How can I help you today?", "bot");
      setTimeout(enableInput, 3000);
    }, 500);
  });

  </script>
</body>
</html>
